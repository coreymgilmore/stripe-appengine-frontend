const MIN_PASSWORD_LENGTH=8,BAD_PASSWORDS=["password","password1","12345678","123456789","123123123","00000000","1234567890","asdfasdf","asdfghjkl","testtest","admin@example.com"],MIN_CHARGE=0.5,MAX_STATEMENT_DESCRIPTOR_LENGTH=22;function validateEmail(a){var b=/^(([^<>()[\]\\.,;:\s@\"]+(\.[^<>()[\]\\.,;:\s@\"]+)*)|(\".+\"))@((\[[0-9]{1,3}\.[0-9]{1,3}\.[0-9]{1,3}\.[0-9]{1,3}\])|(([a-zA-Z\-0-9]+\.)+[a-zA-Z]{2,}))$/;return b.test(a)}function doWordsMatch(a,b){return!(a!==b)}function isLongPassword(a){return!(a.length<MIN_PASSWORD_LENGTH)}function isSimplePassword(a){return-1!==BAD_PASSWORDS.indexOf(a)}function showPanelMessage(a,b,c){c.html("<div class=\"alert alert-"+b+"\">"+a+"</div>")}function showModalMessage(a,b,c){c.html("<div class=\"alert alert-"+b+"\">"+a+"</div>")}$("body").on("click",".action-btn",function(){const a="fast";var b=$(this).data("action"),c=$("#"+b);if(!c.hasClass("show")){var f=$(".action-panels.show");f.fadeOut(a,function(){return f.removeClass("show"),void c.fadeIn(a,function(){c.addClass("show")})}),resetAddCardPanel(),resetChargeCardPanel(!0)}}),$("#create-init-admin").submit(function(a){var b=$("#password1").val(),c=$("#password2").val(),f=$("#create-init-admin .msg");return!1===doWordsMatch(b,c)?(a.preventDefault(),showPanelMessage("The passwords do not match.","danger",f),!1):!1===isLongPassword(b)?(a.preventDefault(),showPanelMessage("Your password is too short. It must be at least "+MIN_PASSWORD_LENGTH+" characters.","danger",f),!1):!0===isSimplePassword(b)?(a.preventDefault(),showPanelMessage("The password you provided is too simple. Please choose a better password.","danger",f),!1):void 0}),$(function(){return $("[data-toggle=\"tooltip\"]").tooltip(),void $.ajaxSetup({dataType:"json"})});function getCards(){var a=$("#customer-list");$.ajax({type:"GET",url:"/card/get/all/",beforeSend:function(){return console.log("Loading cards..."),void a.html("<option value=\"Loading...\">")},error:function(){a.html("<option value=\"Could Not Load\">")},success:function(b){console.log("Loading cards...done!");var c=b.data;return(a.html(""),null===c||0===c.length)?void a.html("<option value=\"None exist yet!\" data-id=\"0\">"):void c.forEach(function(f){var h=f.customer_name,k=f.id;a.append("<option value=\""+h+"\" data-id=\""+k+"\">")})}})}function getCardIdFromDataList(a){var b=a.val(),c=$("#customer-list option"),f="";return c.each(function(){var g=$(this).val(),h=$(this).data("id");if(b===g)return f=h,!1}),f}function generateExpirationYears(){console.log("Loading expiration years...");var a=$("#card-exp-year");a.html("");var b=new Date,c=b.getFullYear();a.append("<option value=\"0\">Please choose.</option>");for(var f=c;f<c+11;f++)a.append("<option value="+f+">"+f+"</option>");console.log("Loading expiration years...done!")}function getUsers(){var a=$(".user-list");$.ajax({type:"GET",url:"/users/get/all/",beforeSend:function(){a.html("<option value=\"0\">Loading...</option>").attr("disabled",!0)},error:function(){a.html("<option value=\"0\">Error (please see dev tools)</option>")},success:function(b){a.html(""),a.append("<option value='0'>Please choose...</option>").attr("disabled",!1);var c=b.data;c.forEach(function(f){"administrator"!==f.username&&a.append("<option value=\""+f.id+"\">"+f.username+"</option>")})}})}$("#form-new-user").submit(function(a){var b=$("#form-new-user .username").val(),c=$("#form-new-user .password1").val(),f=$("#form-new-user .password2").val(),g=$("#form-new-user .can-add-cards input:checked").val(),h=$("#form-new-user .can-remove-cards input:checked").val(),k=$("#form-new-user .can-charge-cards input:checked").val(),l=$("#form-new-user .can-view-reports input:checked").val(),m=$("#form-new-user .is-admin input:checked").val(),n=$("#form-new-user .is-active input:checked").val(),o=$("#form-new-user .msg"),p=$("#form-new-user-submit");return!1===validateEmail(b)?(a.preventDefault(),showModalMessage("You must provide an email address as a username.","danger",o),!1):!1===doWordsMatch(c,f)?(a.preventDefault(),showModalMessage("The passwords do not match.","danger",o),!1):!1===isLongPassword(c)?(a.preventDefault(),showModalMessage("Your password is too short. It must be at least "+MIN_PASSWORD_LENGTH+" characters.","danger",o),!1):!0===isSimplePassword(c)?(a.preventDefault(),showModalMessage("Your password too simple. Choose a more complex password.","danger",o),!1):(o.html(""),a.preventDefault(),$.ajax({type:"POST",url:"/users/add/",data:{username:b,password1:c,password2:f,addCards:g,removeCards:h,chargeCards:k,reports:l,admin:m,active:n},beforeSend:function(){return p.attr("disabled",!0),void showModalMessage("Saving user...","info",o)},error:function(q){var s=JSON.parse(q.responseText);return!1===s.ok?void showModalMessage(s.data.error_msg,"danger",o):void p.attr("disabled",!1)},success:function(){showModalMessage("New user was saved sucessfully!","success",o),setTimeout(function(){p.attr("disabled",!1),resetAddUserModal()},3e3)}}),!1)});function resetAddUserModal(){return $("#form-new-user .username, #form-new-user .password1, #form-new-user .password2").val(""),$("#form-new-user .default").attr("checked",!0).parent("label").addClass("active").siblings("label").removeClass("active"),void $(".msg").html("")}$("#modal-new-user").on("hidden.bs.modal",function(){resetAddUserModal()}),$("#modal-change-pwd, #modal-update-user").on("show.bs.modal",function(){getUsers()}),$("#form-change-pwd").submit(function(a){var b=$("#form-change-pwd .user-list").val(),c=$("#form-change-pwd .password1").val(),f=$("#form-change-pwd .password2").val(),g=$("#form-change-pwd .msg"),h=$("#change-password-submit");return!1===doWordsMatch(c,f)?(a.preventDefault(),showModalMessage("The passwords do not match.","danger",g),!1):!1===isLongPassword(c)?(a.preventDefault(),showModalMessage("Your password is too short. It must be at least "+MIN_PASSWORD_LENGTH+" characters.","danger",g),!1):!0===isSimplePassword(c)?(a.preventDefault(),showModalMessage("Your password too simple. Choose a more complex password.","danger",g),!1):($.ajax({type:"POST",url:"/users/change-pwd/",data:{userId:b,pass1:c,pass2:f},beforeSend:function(){return h.attr("disabled",!0),void showModalMessage("Saving new password...","info",g)},error:function(){showModalMessage("An error occured while trying to update this user's password.","danger",g)},success:function(){showModalMessage("This user's password has been updated.","success",g),setTimeout(function(){h.attr("disabled",!1),resetChangePwdModal()},3e3)}}),a.preventDefault(),!1)});function resetChangePwdModal(){return $(".user-list").val("0"),$("#form-change-pwd .password1").val(""),$("#form-change-pwd .password2").val(""),void $(".msg").html("")}$("#modal-change-pwd").on("hidden.bs.modal",function(){resetAddUserModal()});function resetUpdateUserModal(){return $("#form-update-user label.btn").attr("disabled",!0).removeClass("active"),$("#form-update-user input[type=radio]").attr("disabled",!0).attr("checked",!1),$(".msg").html(""),void $("#update-user-submit").attr("disabled",!0)}$("#modal-update-user").on("hidden.bs.modal",function(){resetUpdateUserModal()}),$("#form-update-user").on("change",".user-list",function(){var a=$(this).val(),b=$("#form-update-user .msg");return 0===a?void resetUpdateUserModal():void $.ajax({type:"GET",url:"/users/get/",data:{userId:a},beforeSend:function(){return resetUpdateUserModal(),void showModalMessage("Retrieving user's permissions...","info",b)},error:function(){showModalMessage("An error occured while trying to retrieve this users data. Please try again.","danger",b)},success:function(c){b.html(""),$("#form-update-user label.btn").attr("disabled",!1),$("#form-update-user input[type=radio]").attr("disabled",!1),$("#update-user-submit").attr("disabled",!1);var f=c.data;return f.add_cards?$("#form-update-user .can-add-cards input[value=true]").attr("checked",!0).parent().addClass("active"):$("#form-update-user .can-add-cards input[value=false]").attr("checked",!0).parent().addClass("active"),f.remove_cards?$("#form-update-user .can-remove-cards input[value=true]").attr("checked",!0).parent().addClass("active"):$("#form-update-user .can-remove-cards input[value=false]").attr("checked",!0).parent().addClass("active"),f.charge_cards?$("#form-update-user .can-charge-cards input[value=true]").attr("checked",!0).parent().addClass("active"):$("#form-update-user .can-charge-cards input[value=false]").attr("checked",!0).parent().addClass("active"),f.view_reports?$("#form-update-user .can-view-reports input[value=true]").attr("checked",!0).parent().addClass("active"):$("#form-update-user .can-view-reports input[value=false]").attr("checked",!0).parent().addClass("active"),f.is_admin?$("#form-update-user .is-admin input[value=true]").attr("checked",!0).parent().addClass("active"):$("#form-update-user .is-admin input[value=false]").attr("checked",!0).parent().addClass("active"),void(f.is_active?$("#form-update-user .is-active input[value=true]").attr("checked",!0).parent().addClass("active"):$("#form-update-user .is-active input[value=false]").attr("checked",!0).parent().addClass("active"))}})}),$("#form-update-user").submit(function(a){var b=$("#form-update-user .user-list").val(),c=$("#form-update-user .can-add-cards label.active input").val(),f=$("#form-update-user .can-remove-cards label.active input").val(),g=$("#form-update-user .can-charge-cards label.active input").val(),h=$("#form-update-user .can-view-reports label.active input").val(),k=$("#form-update-user .is-admin label.active input").val(),l=$("#form-update-user .is-active label.active input").val(),m=$("#form-update-user .msg"),n=$("#update-user-submit");return 0===b.length?(a.preventDefault(),void showModalMessage("A user must be chosen first.","danger",m)):(a.preventDefault(),$.ajax({type:"POST",url:"/users/update/",data:{userId:b,addCards:c,removeCards:f,chargeCards:g,reports:h,admin:k,active:l},beforeSend:function(){return n.attr("disabled",!0),void showModalMessage("Saving updated permissions...","info",m)},error:function(o){var p=JSON.parse(o.responseText);return!1===p.ok?void showModalMessage(p.data.error_msg,"danger",m):void 0},success:function(){return showModalMessage("User updated successfully!","success",m),void setTimeout(function(){n.attr("disabled",!1),m.html("")},3e3)}}),!1)}),$("#add-card").on("change","#card-exp-month",function(){var a=$(this).val(),b=new Date,c=b.getMonth()+1,f=b.getFullYear();a<c?$("#card-exp-year option[value="+f+"]").css({display:"none"}):$("#card-exp-year option[value="+f+"]").css({display:"block"})}),$("#add-card").submit(function(a){var c=$("#add-card"),f=$("#customer-id").val().trim(),g=$("#customer-name").val().trim(),h=$("#cardholder-name").val().trim(),k=$("#card-number").val().trim().replace(" ","").replace("-",""),l=parseInt($("#card-exp-year").val()),m=parseInt($("#card-exp-month").val()),n=$("#card-cvc").val().trim(),o=$("#card-postal-code").val().trim(),p=Stripe.card.cardType(k),q=$("#add-card .submit-form-btn"),s=$("#add-card .msg");if(s.html(""),2>g.length)return a.preventDefault(),showPanelMessage("You must provide a customer name. This can be the same as the cardholder or the name of a company. This is used to lookup cards when you want to create a charge.","danger",s),!1;if(2>h.length)return a.preventDefault(),showPanelMessage("Please provide the name of the cardholder as it is given on the card.","danger",s),!1;var t=k.length;if(14>t||16<t)return a.preventDefault(),showPanelMessage("The card number you provided is "+t+" digits long, however, it must be exactly 15 or 16 digits.","danger",s),!1;if(!1===Stripe.card.validateCardNumber(k))return a.preventDefault(),showPanelMessage("The card number you provided is not valid.","danger",s),!1;var v=new Date,w=v.getMonth()+1,x=v.getFullYear();return 0===m||"0"===m?(a.preventDefault(),showPanelMessage("Please choose the card's expiration month.","danger",s),!1):0===l||"0"===l?(a.preventDefault(),showPanelMessage("Please choose the card's expiration year.","danger",s),!1):l===x&&m<w?(a.preventDefault(),showPanelMessage("The card's expiration must be in the future.","danger",s),!1):!1===Stripe.card.validateExpiry(m,l)?(a.preventDefault(),showPanelMessage("The card's expiration must be in the future.","danger",s),!1):!1===Stripe.card.validateCVC(n)?(a.preventDefault(),showPanelMessage("The security code you provided is invalid.","danger",s),!1):"American Express"===p&&4!==n.length?(a.preventDefault(),showPanelMessage("You provided an American Express card but your security code is invalid. The security code must be exactly 4 numbers long.","danger",s),!1):"American Express"!==p&&3!==n.length?(a.preventDefault(),showPanelMessage("You provided an "+Stripe.card.cardType(k)+" card but your security code is invalid. The security code must be exactly 3 numbers long.","danger",s),!1):5>o.length||6<o.length?(a.preventDefault(),showPanelMessage("The postal code must be exactly 5 numeric or 6 alphanumeric characters.","danger",s),!1):(q.prop("disabled",!0),showPanelMessage("Saving card...","info",s),Stripe.card.createToken({name:h,number:k,cvc:n,exp_month:m,exp_year:l,address_zip:o},function(y,z){return z.error?void showPanelMessage("The credit card could not be saved. Please contact an administrator. Message: "+z.error.message+".","danger",s):void $.ajax({type:"POST",url:"/card/add/",data:{customerId:f,customerName:g,cardholder:h,cardToken:z.id,cardExp:z.card.exp_month+"/"+z.card.exp_year,cardLast4:z.card.last4},error:function(A){var B=JSON.parse(A.responseText);return!1==B.ok?(showPanelMessage(B.data.error_msg,"danger",s),void q.prop("disabled",!1).text("Add Card")):void 0},success:function(){return resetAddCardPanel(),showPanelMessage("Card was saved!","success",s),void setTimeout(function(){s.html(""),q.prop("disabled",!1).text("Add Card"),getCards()},2e3)}})}),a.preventDefault(),!1)});function resetAddCardPanel(){return $("#customer-id").val(""),$("#customer-name").val(""),$("#cardholder-name").val(""),$("#card-number").val(""),$("#card-exp-year").val("0"),$("#card-exp-month").val("0"),$("#card-cvc").val(""),void $("#card-postal-code").val("")}$("#panel-add-card").on("click",".clear-form-btn",function(){return resetAddCardPanel(),void $("#add-card .msg").html("")}),$("#remove-card").submit(function(a){var b=$("#remove-card .customer-name"),c=b.val(),f=getCardIdFromDataList(b),g=$("#remove-card .submit-form-btn"),h=$("#remove-card .msg");return 0===f||"0"===f||0===f.length?(a.preventDefault(),void showPanelMessage("You must choose a customer.","danger",h)):($.ajax({type:"POST",url:"/card/remove/",data:{customerId:f,customerName:c},beforeSend:function(){return g.prop("disabled",!0),void showPanelMessage("Removing card...","info",h)},error:function(k){var l=JSON.parse(k.responseText);!1===l.ok&&(g.prop("disabled",!1),showPanelMessage("An error occured while removing this card. Do not refresh or leave this screen! Please contact an administrator.","danger",h))},success:function(){return g.prop("disabled",!1),showPanelMessage("Card was removed!","success",h),b.val(""),void setTimeout(function(){h.html(""),getCards()},2e3)}}),a.preventDefault(),!1)}),$("#charge-card").on("change",".customer-name",function(){var a=$("#charge-card .customer-name"),b=getCardIdFromDataList(a),c=$("#charge-card .msg");return(c.html(""),""===b)?void showPanelMessage("The customer name you provided is not a real customer. Please choose a customer from the list.","danger",c):void $.ajax({type:"GET",url:"/card/get/",data:{customerId:b},beforeSend:function(){$("#charge-card .customer-cardholder, #charge-card .card-last-four, #charge-card .card-expiration").val("Loading...")},error:function(f){var g=JSON.parse(f.responseText);showPanelMessage(g.data.error_msg,"danger",c)},success:function(f){var g=f.data;return $("#charge-card .customer-cardholder").val(g.cardholder_name),$("#charge-card .card-last-four").val(g.card_last4),$("#charge-card .card-expiration").val(g.card_expiration),void $("#charge-card .charge-amount, #charge-card .charge-invoice, #charge-card .charge-po").prop("disabled",!1)}})}),$("#charge-card").submit(function(a){var b=$("#charge-card .customer-name"),c=b.val(),f=getCardIdFromDataList(b),g=$("#charge-card .charge-amount"),h=parseFloat(g.val()),k=$("#charge-card .charge-invoice"),l=k.val(),m=$("#charge-card .charge-po"),n=m.val(),o=$("#charge-card .msg"),p=$("#charge-card-submit"),q=p.siblings(".dropdown-toggle"),s=p.data("chargeandremove")||!1;return(a.preventDefault(),h<MIN_CHARGE)?(a.preventDefault(),void showPanelMessage("You must provide an amount to charge greater than the minimum charge ("+MIN_CHARGE+").","danger",o)):(p.data("chargeandremove",""),$.ajax({type:"POST",url:"/card/charge/",data:{datastoreId:f,customerName:c,amount:h,invoice:l,po:n,chargeAndRemove:s},beforeSend:function(){return b.prop("disabled",!0),g.prop("disabled",!0),k.prop("disabled",!0),m.prop("disabled",!0),p.prop("disabled",!0),q.prop("disabled",!0),showPanelMessage("Charging card...","info",o),void resetChargeSuccessPanel()},error:function(t){var v=JSON.parse(t.responseText);!1===v.ok&&showPanelMessage(v.data.error_msg,"danger",o)},success:function(t){var v=t.data;$("#panel-charge-success .customer-name").text(v.customer_name),$("#panel-charge-success .cardholder").text(v.cardholder_name),$("#panel-charge-success .card-last4").text(v.card_last4),$("#panel-charge-success .card-exp").text(v.card_expiration),$("#panel-charge-success .amount").text("$"+parseFloat(v.amount).toFixed(2)),$("#panel-charge-success .invoice").text(v.invoice),$("#panel-charge-success .po").text(v.po);var w="/card/receipt/?chg_id="+v.charge_id;$("#show-receipt").attr("href",w);var x=$("#action-panels-container").outerWidth(),y=$("#panel-charge-card"),z=$("#panel-charge-success"),A=$(".action-btn");return A.attr("disabled",!0).children("input").attr("disabled",!0),y.fadeOut(200,function(){y.removeClass("show"),z.fadeIn(200,function(){z.addClass("show"),A.attr("disabled",!1).children("input").attr("disabled",!1)})}),A.removeClass("active"),resetChargeCardPanel(!0),void(s&&setTimeout(function(){getCards()},2e3))}}),!1)}),$(".dropdown-menu.charge-card-options").on("click","#charge-and-remove-card",function(){return $("#charge-card-submit").data("chargeandremove",!0),void $("#charge-card").submit()});function resetChargeCardPanel(a){return $("#charge-card .customer-name").val("").prop("disabled",!1),$("#charge-card .customer-cardholder").val(""),$("#charge-card .card-last-four").val(""),$("#charge-card .card-expiration").val(""),$("#charge-card .charge-amount").val(""),$("#charge-card .charge-invoice").val(""),$("#charge-card .charge-po").val(""),$("#charge-card-submit").prop("disabled",!1),$("#charge-card-submit").siblings(".dropdown-toggle").prop("disabled",!1),$("#charge-card .charge-amount, #charge-card .charge-invoice, #charge-card .charge-po").prop("disabled",!0),void(a&&$("#charge-card .msg").html(""))}$("#panel-charge-card").on("click",".clear-form-btn",function(){resetChargeCardPanel(!0)});function resetChargeSuccessPanel(){return $("#panel-charge-success .customer-name").text(""),$("#panel-charge-success .cardholder").text(""),$("#panel-charge-success .card-last4").text(""),$("#panel-charge-success .card-exp").text(""),$("#panel-charge-success .amount").text(""),$("#panel-charge-success .invoice").text(""),$("#panel-charge-success .po").text(""),void $("#show-receipt").attr("href","")}$("#reports").submit(function(a){var b=$("#reports .customer-name"),c=b.val(),f=getCardIdFromDataList(b),g=$("#reports .start-date").val(),h=$("#reports .end-date").val(),k=$("#reports .msg"),l=$("#reports-submit");if(k.html(""),""===g)return a.preventDefault(),void showPanelMessage("You must choose a Start Date.","danger",k);if(""===h)return a.preventDefault(),void showPanelMessage("You must choose an End Date.","danger",k);if(h<g)return a.preventDefault(),void showPanelMessage("The Start Date must be before the End Date.","danger",k);var m=new Date,n=-1*(m.getTimezoneOffset()/60);$("#timezone").val(n);var b=$("#reports .customer-name"),o=getCardIdFromDataList(b);$("#report-customer-id").val(o)}),$("#report-rows").on("click",".refund",function(){var a=$(this),b=parseFloat(a.parent().siblings("td.amount-dollars").children(".amount").text().replace(",","")).toFixed(2),c=a.data("chgid"),f=$("#refund-amount");return f.val(b).attr("max",b),void $("#refund-chg-id").val(c)}),$("#form-refund").submit(function(a){var b=$("#refund-chg-id").val(),c=$("#refund-amount").val(),f=$("#refund-reason").val(),g=$("#form-refund .msg"),h=$("#refund-submit");return(g.html(""),0===b.length)?(a.preventDefault(),void showModalMessage("A charge ID was not submitted.  Please refresh your browser and try again.","danger",g)):0===c.length||0>parseFloat(c)?(a.preventDefault(),void showModalMessage("You must provide an amount to refund that is greater than zero but less than the amount charged.","danger",g)):(a.preventDefault(),$.ajax({type:"POST",url:"/card/refund/",data:{chargeId:b,amount:c,reason:f},beforeSend:function(){return showModalMessage("Refunding charge...","info",g),void h.prop("disabled",!0)},error:function(k){var l=JSON.parse(k.responseText);!1===l.ok&&(showModalMessage(l.data.error_msg,"danger",g),h.prop("disabled",!1))},success:function(){return showModalMessage("Refund successful!","success",g),h.prop("disabled",!1),$("#refund-amount").val(""),void $("#refund-reason").val("0")}}),!1)}),$("#modal-change-company-info").on("show.bs.modal",function(){var a=$("#modal-change-company-info .msg");$.ajax({type:"GET",url:"/company/get/",beforeSend:function(){showModalMessage("Loading company information...","info",a)},error:function(b){var c=JSON.parse(b.responseText);if(!1===c.ok){if("companyInfoDoesNotExist"===c.data.error_type){return void showModalMessage("You do have any company info set. Your recipts will show up blank without setting the fields above.","info",a)}return showModalMessage("An error occured and your company data could not be loaded.  Please try again.","danger",a),void $("#company-info-submit").prop("disabled",!0)}},success:function(b){var c=b.data;return $("#modal-change-company-info .company-name").val(c.company_name),$("#modal-change-company-info .company-street").val(c.street),$("#modal-change-company-info .company-suite").val(c.suite),$("#modal-change-company-info .company-city").val(c.city),$("#modal-change-company-info .company-state").val(c.state),$("#modal-change-company-info .company-postal").val(c.postal_code),$("#modal-change-company-info .company-country").val(c.country),$("#modal-change-company-info .company-phone").val(c.phone_num),$("#modal-change-company-info .company-email").val(c.email),$("#modal-change-company-info .percentage-fee").val(parseFloat(100*c.percentage_fee).toFixed(2)),$("#modal-change-company-info .fixed-fee").val(c.fixed_fee.toFixed(2)),$("#modal-change-company-info .statement-descriptor").val(c.statement_descriptor),a.html(""),void $("#company-info-submit").prop("disabled",!1)}})}),$("#modal-change-company-info").on("hidden.bs.modal",function(){return $("#modal-change-company-info .msg").html(""),$("#company-info-submit").prop("disabled",!0),void $("#modal-change-company-info input").val("")}),$("#form-change-company-info").submit(function(a){a.preventDefault();var b=$("#modal-change-company-info .company-name").val(),c=$("#modal-change-company-info .company-street").val(),f=$("#modal-change-company-info .company-suite").val(),g=$("#modal-change-company-info .company-city").val(),h=$("#modal-change-company-info .company-state").val(),k=$("#modal-change-company-info .company-postal").val(),l=$("#modal-change-company-info .company-country").val(),m=$("#modal-change-company-info .company-phone").val(),n=$("#modal-change-company-info .company-email").val(),o=parseFloat($("#modal-change-company-info .percentage-fee").val()),p=parseFloat($("#modal-change-company-info .fixed-fee").val()),q=$("#modal-change-company-info .statement-descriptor").val(),s=$("#modal-change-company-info .msg"),t=$("#company-info-submit");return 2<h.length?void showModalMessage("State must be a two character abbreviation.","danger",s):6<k.length?void showModalMessage("Postal code must be 5 or 6 alphanumeric characters.","danger",s):3<l.length?void showModalMessage("Country must be a 2 or 3 character abbreviation.","danger",s):0>o||100<o||isNaN(o)?void showModalMessage("Percentage fee must be a number such as 2.95.","danger",s):0>p||100<p||isNaN(p)?void showModalMessage("Fixed fee must be a number such as 0.30.","danger",s):5>q.length||22<q.length?void showModalMessage("Statement descriptor must be between 5 and 22 characters long.  It is currently "+q.length+" characters.","danger",s):($.ajax({type:"POST",url:"/company/set/",data:{name:b,street:c,suite:f,city:g,state:h,postal:k,country:l,phone:m,email:n,percentFee:o,fixedFee:p,descriptor:q},beforeSend:function(){showModalMessage("Saving company information...","info",s),t.prop("disabled",!0)},error:function(v){var w=JSON.parse(v.responseText);if(!1===w.ok)return void showModalMessage("An error occured and your company info could not be saved.","danger",s)},success:function(){return showModalMessage("Company information was saved!","success",s),t.prop("disabled",!1),void setTimeout(function(){s.html("")},3e3)}}),!1)}),$("#modal-app-settings").on("show.bs.modal",function(){var a=$("#modal-app-settings .msg");$.ajax({type:"GET",url:"/app-settings/get/",beforeSend:function(){showModalMessage("Loading app settings...","info",a)},error:function(b){var c=JSON.parse(b.responseText);if(!1===c.ok)return showModalMessage("An error occured and your app settings could not be loaded.  Please try again.","danger",a),void $("#app-settings-submit").prop("disabled",!0)},success:function(b){var c=b.data;return c.require_cust_id?$("#form-change-app-settings .require-cust-id input[value=true]").attr("checked",!0).parent().addClass("active"):$("#form-change-app-settings .require-cust-id input[value=false]").attr("checked",!0).parent().addClass("active"),$("#modal-app-settings .cust-id-format").val(c.cust_id_format),""===c.api_key?$("#api-key-displayed").val("Not created yet."):$("#api-key-displayed").val(c.api_key),a.html(""),void $("#app-settings-submit").prop("disabled",!1)}})}),$("#modal-app-settings").on("hidden.bs.modal",function(){return $("#modal-app-settings .msg").html(""),$("#app-settings-submit").prop("disabled",!0),void $("#modal-app-settings input").val("")}),$("#form-change-app-settings").submit(function(a){a.preventDefault();var b=$("#modal-app-settings .require-cust-id label.active input").val(),c=$("#modal-app-settings .cust-id-format").val(),f=$("#modal-app-settings .msg"),g=$("#app-settings-submit");return $.ajax({type:"POST",url:"/app-settings/set/",data:{requireCustID:b,custIDFormat:c},beforeSend:function(){showModalMessage("Saving app settings...","info",f),g.prop("disabled",!0)},error:function(h){var k=JSON.parse(h.responseText);if(!1===k.ok)return void showModalMessage("An error occured and your app settings could not be saved.","danger",f)},success:function(){return showModalMessage("App settings saved! Refresh the app to see the changes applied.","success",f),g.prop("disabled",!1),void setTimeout(function(){f.html("")},5e3)}}),!1}),$("#form-change-app-settings").on("click","#generate-api-key",function(){var a=$("#modal-app-settings .msg");$.ajax({type:"GET",url:"/app-settings/generate-api-key/",beforeSend:function(){showModalMessage("Getting new API key...","info",a)},error:function(b){var c=JSON.parse(b.responseText);if(!1===c.ok)return void showModalMessage("An error occured and an API key could not be generated.  Try again.","danger",a)},success:function(b){return $("#api-key-displayed").val(b.data),showModalMessage("New API key generated.","success",a),void setTimeout(function(){a.html("")},3e3)}})});